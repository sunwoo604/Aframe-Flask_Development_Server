<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-lines@^1.1.0/lines.js"></script>
    <script src="{{ url_for('static', filename = 'aframe-gui.js') }}"></script>
    <script src="{{ url_for('static', filename = 'functions.js') }}"></script>
  </head>
  <body>
    <a-scene>
      <a-camera look-controls-enabled wasd-controls-enabled>
        <a-entity id="mouseCursor"
        cursor="rayOrigin: mouse">
        </a-entity>
      </a-camera>
      <!--Ground-->
        <a-plane color="#999999"
        rotation ="-90 0 0 "
        scale="1000 1000 1"></a-plane>
        <!--Slider for percent-->
        <a-gui-slider id="sld" width="2.5" height="0.75" 
        onclick="func(this)" margin="0 0 0.05 0" position="-2 1 1"
        percent="0.29">
        </a-gui-slider>
      <!--User input for log beta-->
      <a-text id="numWindow" 
      value=""
      position="5 1 0"
      geometry="primitive: plane; width: 2; height: 0.5"
      material = "color: grey"
      align="center">
      </a-text>
      <!--User input for molecules-->
      <a-text id="molWindow" 
      value=""
      position="5 2 0"
      geometry="primitive: plane; width: 2; height: 0.5"
      material = "color: grey"
      align="center">
      </a-text>
      <a-text
      onclick="submit()"
      position="8 2 0"
      geometry="primitive: plane; width: 2; height: 0.5"
      material = "color: grey"
      align="center">
      </a-text>
      <a-text value="0" 
      geometry="primitive: plane; width: 0.5; height: 0.5"
      material = "color: grey"
      onclick="inputNum(this)"
      position="4 1 0"
      align="center">
      </a-text>
      {% if out %}
      <!--Magic numbers-->
        {% set xmin = 3 %}
        {% set xmax = 4 %}
        {% set ymin = 5 %}
        {% set ymax = 6 %}
        {% set sc = namespace(xscale = out[7]) %}
        {% set sc2 = namespace(yscale = out[8]) %}
        {% set xstep = 9 %}
        {% set ystep = 10 %}
        {% set points = 11 %}
        {% set minmax = 12 %}
        {% set colorsets = ["#AA0000","#00AA00","#0000AA","#AAAA00", "#00AAAA"] %}
        {% set ns = namespace(id=0) %}

        
        {% for mol in out[1] %}
        <!--Trend visibility button-->
        <a-box 
            id="button{loop.index-1}}"
            position="-6 0.5 {{loop.index*-5}}"
            color="grey"
            height="0.5"
            width="0.5"
            depth="0.2"
            onclick="showLine('{{loop.index-1}}')">
            <script type="text/javascript">
              function showLine(idx){
                let line = document.getElementById(idx+'trend');
                let index=parseInt(idx);
                line.setAttribute("visible", "true");
                for(let i = 1001*index+1;i<1000*(index+1)+1;i++)
                {
                  let ball = document.getElementById("ball"+i);
                  ball.setAttribute("visible", "false");
                }
              }
            </script>
            <a-text value="show trend \nfor {{mol}}"
            position="0 0 0.1"
            align="center"
            height="2"
            width="2"></a-text>
        </a-box>
        <a-box 
            id="button2{{loop.index}}"
            position="-5.5 0.5 {{loop.index*-5}}"
            color="grey"
            height="0.5"
            width="0.5"
            depth="0.2"
            onclick="showDatas('{{loop.index-1}}')"
            >
            <script type="text/javascript">
              function showDatas(idx){
                let line = document.getElementById(idx+'trend');
                let index=parseInt(idx);
                line.setAttribute("visible", "false");
                for(let i = 1001*index+1;i<1001*(index+1)+1;i++)
                {
                  let ball = document.getElementById("ball"+i);
                  ball.setAttribute("visible", "true");
                }
              }
            </script>
            <a-text value="show datas \nfor {{mol}}"
            position="0 0 0.1"
            align="center"
            height="2"
            width="2"></a-text>
        </a-box>
        <!--Min max buttons and windows-->
        <!--
        <a-text 
          position="{{loop.index-1}} 1 1" value="{{mol}}" 
          geometry="primitive: plane; width: 1; height: 1"
          rotation="-20 0 0"
          material = "color: grey"
          align="center"
          event-set__enter1="_event: mouseenter; _target: #minmax{{loop.index}}; visible: true"
          event-set__leave1="_event: mouseleave; _target: #minmax{{loop.index}}; visible: false">
        </a-text>

        <a-text id="minmax{{loop.index}}"
          geometry="primitive: plane; width: 4; height: 1"
          position="2 2.5 0.5"
          material = "color: {{colorsets[loop.index-1]}}"
          visible="false"
          align="center"
          value="max: {{out[minmax][loop.index-1][0]}} \nmin: {{out[minmax][loop.index-1][1]}}">
        </a-text>
        {% endfor %}
        -->

        <!--Trend lines-->
        {% for points in out[points] %}
        <a-lines id="{{loop.index-1}}trend"
        points="{{points}}"
        color="{{colorsets[loop.index-1]}}"
        visible="false">
        </a-lines>
        {% endfor %}

        <!--Data plots and its data text values(Graph)-->
        {% for lst in out[0] %}
        {% set vr = namespace(var=loop.index) %}
        <!--x and y axis-->
        <a-box color="black" height="20" width="0.02" depth="0.02" position="0 0 {{vr.var*-5}}"></a-box>
        <a-box color="black" height="10" width="0.02" depth="0.02" position="5 0 {{vr.var*-5}}" rotation="0 0 90"></a-box>
        {% for x in out[xstep] %}
        <a-text value="{{x}}" 
        position="{{(x-out[xmin])*sc.xscale}} 0.2 {{vr.var*-5}}"
        color="black" align="center"
        height="5"
        width="5"></a-text>
        {% endfor %}
        {% for y in out[ystep] %}
        <a-text value="{{y}}" 
        position="0 {{(loop.index-1)*2}} {{vr.var*-5+0.5}}"
        color="black" align="center"
        height="5"
        width="5"></a-text>
        {% endfor %}

        <!--Molecules labels-->
        <a-text id="{{loop.index-1}}label"
          value="{{out[1][loop.index-1]}}" position="-5 1 {{vr.var*-5}}"
          geometry="primitive: plane; width: 3; height: 2" material = "color: {{colorsets[vr.var-1]}}" align="center"
          height="20"
          width="20">
        </a-text>

        <!--plots-->
            {% for val in lst %}
            {% set ns.id=ns.id+1 %}
            <a-sphere id="ball{{ns.id}}"
            position="{{(out[2][loop.index-1]-out[xmin])*sc.xscale}} {{val*sc2.yscale}} {{vr.var*-5}}"
            color="{{colorsets[vr.var-1]}}"
            radius="0.05"
            event-set__enter="_event: mouseenter; radius: 0.1"
            event-set__leave="_event: mouseleave; radius: 0.05"
            event-set__enter1="_event: mouseenter; _target: #data{{ns.id}}; visible: true"
            event-set__leave1="_event: mouseleave; _target: #data{{ns.id}}; visible: false">
                <a-text
                id="data{{ns.id}}"
                color="{{colorsets[vr.var-1]}}"
                value="m: {{out[1][vr.var-1]}} ph: {{out[2][loop.index-1]}} c: {{val}}"
                geometry="primitive: plane; width: 4; height: 0.75"
                material = "color: {{colorsets[vr.var-1]}}"
                position="0 1 0"
                align="center"
                visible="false"></a-text>
                </a-text>
            </a-sphere>
            {% endfor %}
        {% endfor %}
      {% endif %}
    </a-scene>   
  </body>
</html>
